(function(){var PJ_PRD_STATUS_DEF,addToShoppingBag,changeColor,changeSize,dom,hideAjaxLoader,hideColorPopup,init,item,resetPopup,s7Url,setItemInfo,showAjaxLoader,showPopup,templates;showAjaxLoader=function(e){$("#ajax-loader").show(),"undefined"!=typeof e&&setTimeout(hideAjaxLoader,e)},hideAjaxLoader=function(){$("#ajax-loader").hide()},showPopup=function(e){var t,i;dom.title.html(item[e].product),dom.color.empty(),$(item[e].color).each(function(e){var t,i,o;t=PJ_PRD_STATUS_DEF.color[this.status],o=dom.dummy.clone(),i=this.imgSet,o.children("input").attr("id","item"+e).attr("value",i).change(function(){changeColor(this,i)}),0===e&&o.children("input").attr("checked","checked"),o.children("label").attr("for","item"+e),o.find("ul li img").attr("src",t.icon).attr("alt",t.label),o.children("img").attr("src",s7Url+this.imgSet).attr("alt",this.label),o.find("div p").text(this.label),dom.color.append(o)}),resetPopup(),t=dom.color.find("li:first input"),changeColor(t,t.attr("value")),$("#item-confirm").show(),i=$(window).scrollTop(),$("#item-confirm").css("top",i+"px"),$("#yummyHeader").length>0&&(i+=$("#yummyHeader").height()),$("#item-popup").css("top",i+200+"px")},resetPopup=function(){dom.size.find("option[value]").remove(),dom.detail.html(""),dom.price.html(""),dom.stock.html(""),dom.code.html(""),dom.amount.val("1").prop("disabled",!0),dom.btn.addClass("disabled")},hideColorPopup=function(e){$(e).parents(".popup").animate({left:0},500),$(e).parents(".choose-color-select.slide-block").find(".drop.slide-box").hide(),$(e).parents(".choose-color-select.slide-block").css("position","realtive"),setTimeout(function(){return $(".popup").css({right:"0"})},500)},setItemInfo=function(e){var t,i,o;o=$(e).parents("li.item").find("div.holder p").text(),i=$(e).parents("li.item").children("img").attr("src"),t=$(e).parents("li.item").find("div.holder ul li img").attr("src"),$(e).parents(".choose-color-select.slide-block").find(".selected.item div.holder p").text(o),$(e).parents(".choose-color-select.slide-block").find(".selected.item > img").attr("src",i),$(e).parents(".choose-color-select.slide-block").find(".selected.item ul li img").attr("src",t),$(e).parents(".choose-color-select.slide-block").removeClass("slide-active"),$(e).parents(".choose-color-select.slide-block").css("position","inherit")},changeColor=function(e,t){var i,o;return o=t.substr(0,7),"undefined"==typeof item[o]?void hideColorPopup(e):(i=null,$(item[o].color).each(function(){return this.imgSet===t?(i=this,!1):void 0}),null===i?void hideColorPopup(e):(resetPopup(),setItemInfo(e),dom.size.find("option[value]").remove(),$(i.size).each(function(){var e,t;switch(t="",this.status){case"0":t=" (在庫あり)";break;case"1":t=" (完売)";break;case"2":t=" (在庫わずか)";break;case"4":t=" (在庫あり)";break;case"17":t=" (入荷待ち)"}e=$("<option />").attr("value",this.skuCode).attr("size-code",this.sizeCode).html(this.label+t),dom.size.append(e)}),void hideColorPopup(e)))},changeSize=function(e){var t,i,o,s,a,c,l,n;n=e.val(),c=n.substr(0,7),a=n.substr(0,9),t=TAX_DISP_INFO.TAX_DISP_DEFINITION.TAX_EXCLUSIVE,i=t.MODE_FLAG?t.MODE_EXPLAIN_WORD:"(税込)","undefined"!=typeof item[c]&&(s=null,$(item[c].color).each(function(){return this.imgSet===a?(s=this,!1):void 0}),null!==s&&(l=null,$(s.size).each(function(){return this.skuCode===n?(l=this,!1):void 0}),null!==l&&(dom.detail.html(l.detail),dom.stock.html(l.stockStatus),dom.price.html("￥"+l.price+i),o=c+"-"+n.substr(7,2)+"-"+n.substr(9,2),dom.code.html(o),"1"!==l.status&&(dom.amount.prop("disabled",!1),dom.btn.removeClass("disabled"),$("[name=sku_code]").val(n)))))},item={},s7Url="http://peachjohn.scene7.com/is/image/PeachJohn/",dom={},init=function(){0===$("#item-confirm").size()&&$("body").append(templates.confirm),0===$("#item-popup").size()&&$("body").append(templates.complete),"undefined"==typeof TAX_DISP_INFO&&$.getScript("/common/front/js/header.js"),$("a[data-window=item-modal]").unbind("click"),dom={"popup-link":$("*[data-item-id]"),title:$("#item-confirm strong.product-name"),icon:$("#item-confirm div.selected.item ul li img"),image:$("#item-confirm div.selected.item > img"),label:$("#item-confirm div.selected.item div p"),dummy:$("#item-confirm div.dummy > li"),color:$("#item-confirm ul.list"),size:$("#item-confirm #product-size"),detail:$("#item-confirm #product-detail"),stock:$("#item-confirm #product-stock"),price:$("#item-confirm #product-price"),code:$("#item-confirm #product-code"),amount:$("#item-confirm #purchase-amount-select"),btn:$("#item-confirm #btnAddCart")},dom["popup-link"].click(function(e){var id,orig_this,url;orig_this=this,e.preventDefault(),id=$(this).attr("data-item-id"),$("[name=baitai_code]").val($(this).data("baitai_code")),$("[name=baitai_type]").val($(this).data("baitai_type")),$("[name=brand]").val($(this).data("brand")),"undefined"!=typeof item[id]?showPopup(id):(showAjaxLoader(),url="/pjitem/detail/?ITM="+id+"&outlet=include",$.ajax({type:"GET",url:url,beforeSend:function(e){e.overrideMimeType("text/html;charset=Shift_JIS")}}).done(function(raw_data){var data;return data=raw_data.replace(/[\s\S]+^(var PJ_PRD_INFO = {[\s\S]+?    };)$[\s\S]+/m,"$1"),""===data||null===data?(alert("該当の商品がありません"),!1):(eval(data),""===PJ_PRD_INFO.custCode||""===PJ_PRD_INFO.product||0===PJ_PRD_INFO.color.length?(alert("該当の商品がありません"),!1):(item[id]=PJ_PRD_INFO,void showPopup(id)))}).always(function(){hideAjaxLoader()}))}),dom.size.change(function(){changeSize($(this))}),$(".btn-add-to-cart").click(function(e){return $(this).hasClass("disabled")?($(".soldout-error").text().length<1&&"完売"===$("#product-stock").text()&&($(".soldout-error").append("この商品は完売しました"),$(".select-error").text("")),$(".select-error").text().length<1&&""===$("#product-stock").text()&&($(".select-error").append("サイズを選択してください"),$(".soldout-error").text("")),e.preventDefault(),!1):(dom.btn.addClass("disabled"),void addToShoppingBag())}),$("#product-size").change(function(){$(".select-error").text(""),$(".soldout-error").text("")}),$(".popup-close").click(function(e){return e.preventDefault(),$(".fader").hide(),$(".popup").hide(),$(".wrapper").show()}),$(".drop.slide-box li.item").length&&($(".drop.slide-box li.item input").on("change",function(){var e,t;return t=$(this).parents("li.item").find("div.holder p").text(),e=$(this).parents("li.item").find("img").attr("src"),$(this).parents(".choose-color-select.slide-block").find(".selected.item div.holder p").text(t),$(this).parents(".choose-color-select.slide-block").find(".selected.item > img").attr("src",e),$(this).parents(".choose-color-select.slide-block").removeClass("slide-active"),$(this).parents(".choose-color-select.slide-block").css("position","inherit"),$(this).parents(".popup").animate({left:0},500),$(this).parents(".choose-color-select.slide-block").find(".drop.slide-box").hide(),$(this).parents(".choose-color-select.slide-block").css("position","realtive"),setTimeout("$('.popup').css({right: '0'})",500),$(".fader").show()}),$("a.btn-back").click(function(){return $(this).parents(".choose-color-select.slide-block").css("position","inherit"),$(this).parents(".popup").animate({left:0},500),$(this).parents(".choose-color-select.slide-block").removeClass("slide-active"),$(this).parents(".choose-color-select.slide-block").find(".drop.slide-box").hide(),$(this).parents(".choose-color-select.slide-block").css("position","realtive"),setTimeout("$('.popup').css({right: '0'})",500),$(".fader").show()}),$(".choose-color-opener").click(function(){var e;e=$(document).width()-30,$(this).parents(".choose-color-select.slide-block").css("position","inherit"),$(this).parents(".popup").css({right:"inherit"}),$(this).parents(".popup").animate({left:"-"+e+"px"},500),$(this).parents(".choose-color-select.slide-block").find(".drop.slide-box").css("left",e+8+"px").show(),$(".fader").hide()}))},PJ_PRD_STATUS_DEF={color:{0:{label:"",icon:"/common/front/img/pj/ico_0035_00.gif",stockOut:!1,"N/A":!1},1:{label:"完売",icon:"/common/front/img/pj/icon/ico_0035_05.gif",stockOut:!0,"N/A":!1},19:{label:"まとめ買い割引",icon:"/common/front/img/pj/icon/ico_114_19.gif",stockOut:!1,"N/A":!1},20:{label:"特別割引",icon:"/common/front/img/pj/icon/ico_114_20.gif",stockOut:!1,"N/A":!1},18:{label:"セット割引",icon:"/common/front/img/pj/icon/ico_114_18.gif",stockOut:!1,"N/A":!1},12:{label:"セール",icon:"/common/front/img/pj/icon/ico_0035_01.gif",stockOut:!1,"N/A":!1},13:{label:"セール",icon:"/common/front/img/pj/icon/ico_0035_04.gif",stockOut:!1,"N/A":!1},15:{label:"Web限定",icon:"/common/front/img/pj/icon/ico_0035_02.gif",stockOut:!1,"N/A":!1},5:{label:"NEW",icon:"/common/front/img/pj/icon/ico_0035_03.gif",stockOut:!1,"N/A":!1}},size:{X:{label:"",icon:"/common/front/img/pj/ico_0036_00.gif",stockOut:!0,"N/A":!0},0:{label:"在庫あり",icon:"/common/front/img/pj/ico_0036_00.gif",stockOut:!1,"N/A":!1},1:{label:"完売",icon:"/common/front/img/pj/icon/ico_0036_04.gif",stockOut:!0,"N/A":!1},2:{label:"在庫わずか",icon:"/common/front/img/pj/icon/ico_0036_02.gif",stockOut:!1,"N/A":!1},17:{label:"入荷待ち",icon:"/common/front/img/pj/icon/ico_0036_03.gif",stockOut:!1,"N/A":!1},4:{label:"NEW",icon:"/common/front/img/pj/icon/ico_0036_01.gif",stockOut:!1,"N/A":!1}}},addToShoppingBag=function(){var e,t;t="/item/addshoppingbag/",e={sku_code:$("[name=sku_code]").val(),order_num:$("[name=amount]").val(),brand:$("[name=brand]").val(),baitai_code:$("[name=baitai_code]").val(),baitai_type:$("[name=baitai_type]").val(),randomkey:(new Date).getTime()},$(".popup-close").trigger("click"),$("#item-popup").show(),$(".ajax-loader").show(),$(".shopping-info").hide(),$.getJSON(t,e,function(t){var i,o,s,a;switch(t.status){case 0:$(".shopping-info header").text(t.statusText).siblings().hide();break;case 1:i=dom.price.text(),a=parseInt(i.match(/\d+/))*e.order_num,$(".shopping-info .title span").html(dom.title.html()),$(".shopping-info img").attr("src",$("div.selected.item > img").attr("src")),$(".shopping-info .color").text($("div.selected.item > div > p").text()),$(".shopping-info .size").text($("#product-size option:selected").text()),$(".shopping-info .itemrate").text(i),$(".shopping-info .amount").text(e.order_num),$(".shopping-info .price span").html("&yen;"+a),$(".shopping-info header").text($("#shoppingbag-add-msg").text()).siblings().show()}return $(".ajax-loader").hide(),$(".shopping-info").show(),$("#yummyHeader").length>0&&(s=Number($("#item-popup").css("top").replace(/px/,"")),s+=$("#yummyHeader").height(),$("#item-popup").css("top",s+"px")),"function"==typeof s_gi&&(o=s_gi(s_account),o.linkTrackVars="events,products",o.events=o.linkTrackEvents="scAdd",o.tl(!0,"o","shopping_bag")),!0})},templates={confirm:'<div id="item-confirm" class="popup top" style="z-index: 50000;"> <div class="add-tyo-cart"> <div class="heading"> <a href="javascript:void(0);" class="popup-close">閉じる</a> <strong class="title">カートに商品を追加</strong> </div> <form action="#"> <div class="container"> <strong class="product-name">商品タイトル</strong> <span class="label">カラーを選ぶ</span> <div class="choose-color-select slide-block"> <div class="selected item"> <img src="assets/img200.jpg" width="29" height="34" style="width: 29px;" /> <div class="holder"> <ul class="tags"><li><img src="images/tag-new.png" width="18" height="12" style="width: 18px;" /></li></ul> <p></p> </div> <a class="choose-color-opener" href="javascript:void(0);"></a> </div> <div class="drop slide-box"> <a class="btn-back" href="javascript:void(0);">戻る</a> <div class="drop-holder"> <p>お好きなカラーを選択してください。</p> <div class="dummy" style="display: none;"> <li class="item"> <input class="radio" type="radio" name="choose-color" id="item01" /> <label for="item01"></label> <img src="" width="29" height="34" alt="" style="width: 29px;" /> <div class="holder"> <ul class="tags"><li><img src="" width="" height="" alt="" style="width: 50%" /></li></ul> <p>選択して下さい</p> </div> </li> </div> <ul class="list"></ul> </div> </div> </div> <div class="selects-holder"> <div class="row"> <label>サイズを選ぶ</label> <select class="select" id="product-size"><option>選択して下さい</option></select> <a href="/pj/size/" target="_blank">サイズ確認</a> </div> <div class="row"> <label>数量</label> <select class="select" name="amount" id="purchase-amount-select"> <option value="1">1</option> <option value="2">2</option> <option value="3">3</option> <option value="4">4</option> <option value="5">5</option> <option value="6">6</option> <option value="7">7</option> <option value="8">8</option> <option value="9">9</option> </select> </div> </div> <div class="confirm-panel"> <dl class="no-bd"> <dt>詳細(cm)</dt><dd id="product-detail"></dd> <dt>在庫</dt><dd id="product-stock"></dd> <dt>価格</dt><dd id="product-price"></dd> <dt>商品番号</dt><dd id="product-code"></dd> </dl> <input type="hidden" name="sku_code" value=""> <input type="hidden" name="baitai_code" value=""> <input type="hidden" name="baitai_type" value=""> <input type="hidden" name="brand" value=""> <a id="btnAddCart" href="#item-popup" data-window="item-modal" class="btn-add-to-cart disabled">購入する</a> </div> </div> </form> </div> </div>',complete:'<div class="item-popup" id="item-popup" style="width: 292px; margin-top: -200px; margin-left: -150px"> <div class="ajax-loader"> <div class="box"><img src="images/ajax-loader.gif" /></div> </div> <div class="shopping-info" style="display:none;"> <header></header> <div class="box"> <div class="title"><strong>商品名</strong><span></span></div> <section> <figure><img src="" alt="image description" width="95" height="111" /></figure> <div class="holder"> <table> <tr><th>カラー</th><td><span class="color"></span></td></tr> <tr><th>サイズ</th><td><span class="size"></span></td></tr> <tr><th>価格</th><td><span class="itemrate"></span></td></tr> <tr><th>数量</th><td><span class="amount"></span><span>個</span></td></tr> </table> </div> </section> </div> <div class="price">合計 <span></span> (税込み)</div> </div> <footer> <a class="btn-close white" href="javascript:$(\'#item-popup\').hide();"><span>閉じる</span></a> <a class="btn-view" href="/shopping/bag/">カートを見る</a> </footer> <div id="shoppingbag-add-msg" style="display:none">商品が追加されました</div> </div>'},Rtoaster._spflush=Rtoaster.flush,Rtoaster.flush=function(e){Rtoaster._spflush(e),e||init()}}).call(this);
